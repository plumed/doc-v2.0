
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Plumed 2.0: user manual: Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top">
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="../pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <img src="../logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="../user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Plumed 2.0: user manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>


<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="glossary.html"><span>Glossary</span></a></li>
      <li><a href="tutorials.html"><span>How-tos</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>

<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>


<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Introduction</a></li>  </ul>
</div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Installation </div>  </div>
</div>
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="CompilingPlumed"></a>
Compiling PLUMED</h1>
<p>PLUMED does not yet have any automatic configuration procedure and most of the decisions should be taken by the user. As a first step configure with the command: </p>
<pre class="fragment">&gt; ./configure.sh
</pre><p>You will have to choose among a set of available preconfigured files. Choose the one closest to your machine, then edit the resulting Makefile.conf file. Notable variables there:</p>
<ul>
<li>LIBS : these are the libraries needed when patching an MD code; typically only "-ldl" (needed to have functions for dynamic loading).</li>
<li>DYNAMIC_LIB : these are the libraries needed to compile the PLUMED library (e.g. -L/path/to/matheval -lmatheval etc). Notice that for the PLUMED shared library to be compiled properly these should be dynamic libraries. Also notice that PLUMED requires BLAS and LAPACK library; see <a class="el" href="_installation.html#BlasAndLapack">BLAS and LAPACK</a> for further info.</li>
<li>CPPFLAGS : add here definition needed to enable specific optional functions; e.g. use -D__PLUMED_HAS_MATHEVAL to enable matheval library</li>
<li>SOEXT : this gives the extension for shared libraries in your system, typically "so" on unix, "dylib" on mac; in case your system does not support dynamic libraries or, for some other reason, you would like only static executables you can just set this variable to a blank ("SOEXT=").</li>
</ul>
<p>Also notice that a new file sourceme.sh appears in the main PLUMED directory. This file should be "sourced" (presently only working for bash shell) if you want to use PLUMED <em>without installing it</em> (i.e. from the compilation directory. It is a good idea to source it now: </p>
<pre class="fragment">&gt; source sourceme.sh
</pre><p>Then compile PLUMED </p>
<pre class="fragment">&gt; make -j 4
</pre><p>If compilation is successful, a "plumed" executable should be in your path. Try to type </p>
<pre class="fragment">&gt; plumed -h
</pre><p>You can also check if PLUMED is correctly compiled performing our regression tests. Be warned that some of them just fails because of the different numerical accuracy of different machines. </p>
<pre class="fragment">&gt; cd regtest
&gt; make
</pre><p> Notice that regtests are performed using the "plumed" executable that is currenty in the path. You can check with exact version they will use with the command </p>
<pre class="fragment">&gt; which plumed
</pre><p> This means that if you do not source "sourceme.sh" file, tests will fails. Moreover, in case you have another version of PLUMED installed somewhere regtests might use that one instead of the just-compiled one.</p>
<p>Also notice that the compiled executable, which now sits in src/lib/plumed, relies on other resource files present in the compilation directory. This directory should thus stay in the correct place, and one should not rename or delete it. The path to the PLUMED root directory is indeed hardcoded in the plumed executable and can be verified with </p>
<pre class="fragment">&gt; plumed info --root
</pre><p> In case you try to use the plumed executable without the compilation directory in place (e.g. you move away the src/lib/plumed static executable and delete or rename the compilation directory) PLUMED will not work correctly and will give you an error message </p>
<pre class="fragment">&gt; plumed help
ERROR: I cannot find /xxx/yyy/patches directory
</pre><p> You can force plumed to run anyway using the option &ndash;standalone-executable: </p>
<pre class="fragment">&gt; plumed --standalone-executable help
</pre><p> Anyway, many features will not be available in this way. This is currently the only way to use a PLUMED static executable on Windows.</p>
<h1><a class="anchor" id="BlasAndLapack"></a>
BLAS and LAPACK</h1>
<p>We tried to keep PLUMED as independent as possible from external libraries. Moreover, some libraries (e.g. Almost and Matheval) providing extra features are optional. However, to have a properly working PLUMED you need to link BLAS and LAPACK libraries. Here you find some note.</p>
<p>First of all, the DYNAMIC_LIB variable in the configuration file should contain the flag necessary to load these libraries (typically -llapack -lblas, in some case followed by -lgfortran but full path specification with -L should be necessary depending on your system configuration).</p>
<p>Even though you can incur in some problem.</p>
<ul>
<li>If the linker complains and suggest to recompiled lapack with -fPIC, it means that you have static lapack libraries. Either install dynamic lapack libraries or switch to static compilation of PLUMED (by unsetting the SOEXT variable in configuration file).</li>
<li>If the linker complains that dsyevr_ cannot be found, try to add -DF77_NO_UNDERSCORE to CPPFLAGS</li>
<li>If the linker complains about other missing functions (typically starting with "for_" prefix) then you should link also Fortran libraries. Indeed, PLUMED is written in C++ and often C++ linkers do not include by default Fortran libraries which are required for lapack and blas to work. Please check the documentation of your compiler.</li>
</ul>
<h1><a class="anchor" id="Installing"></a>
Installing PLUMED</h1>
<p>It might be convenient to install PLUMED in a predefined location. This will allow you to remove the original compilation directory, or to recompile e.g. a different PLUMED version in the same place. Notice that installation <em>is optional</em>. Even from the compilation directory, if environment is properly set (see sourceme.sh file) PLUMED should work.</p>
<p>To install PLUMED one should first decide the location. Just set the environment variable PLUMED_PREFIX, then type "make install" </p>
<pre class="fragment">&gt; export PLUMED_PREFIX=$HOME/opt
&gt; make install
</pre><p> If PLUMED_PREFIX is not set, it will be assumed to be /usr/local. The install command should be executed with root permissions (e.g. "sudo make install") in case you want to install PLUMED on a system directory. An almost full copy of the compilation directory will be installed into $PLUMED_PREFIX/lib/plumed/ directory. A link to the proper PLUMED executable will be set up in $PLUMED_PREFIX/bin, PLUMED include files will be copied to $PLUMED_PREFIX/include/plumed and PLUMED libraries will be linked to $PLUMED_PREFIX/lib.</p>
<p>One should then set the environment properly. We suggest to do it using the module framework (<a href="http://modules.sourceforge.net">http://modules.sourceforge.net</a>). An ad hoc generated module file for PLUMED can then be found in $PLUMED_PREFIX/lib/plumed/src/lib/modulefile Just edit it at your will and put it in your modulefile directory. This will also allow you to install several PLUMED versions alongside and switch among them. If you do not want to use modules, you can still have a look at the modulefile we did so as to know which environment variables should be set for PLUMED to work correctly.</p>
<p>If the environment is properly configured one should be able to do the following things:</p>
<ul>
<li>use "plumed" executable from the command line. this is also possible before installing.</li>
<li>link against the PLUMED library using "-lplumed" flag for the linker. this allows one to use PLUMED library in general purpose programs</li>
<li>use the PLUMED internal functionalities (C++ classes) including header files such as "#include &lt;plumed/tools/Vector.h&gt;". this is also usefule to exploit the PLUMED library in general purpose programs</li>
</ul>
<p>As a final note, one may want to install several PLUMED version alongside without using modules. An alternative is to also define the environment variable PLUMED_LIBSUFFIX. E.g. with </p>
<pre class="fragment">&gt; export PLUMED_PREFIX=$HOME/opt
&gt; export PLUMED_LIBSUFFIX=v2.0
&gt; make install
</pre><p> will install plumed executable with name "plumed-v2.0". All the other files will be renamed accordingly, e.g. the PLUMED library will be loaded with "-lplumed-v2.0" and the PLUMED header files will be included with "#include &lt;plumed-v2.0/tools/Vector.h&gt;. This trick is useful if you do not want to set up modules, but we think using modules (see above) is more flexible.</p>
<h1><a class="anchor" id="Patching"></a>
Patching your MD code</h1>
<p>At the present times PLUMED can be added to the following list of codes:</p>
<ul>
<li><a class="el" href="gromacs-4_5_5.html">gromacs-4.5.5</a></li>
<li><a class="el" href="gromacs-4_6_5.html">gromacs-4.6.5</a></li>
<li><a class="el" href="lammps-6_apr13.html">lammps-6Apr13</a></li>
<li><a class="el" href="namd-2_8.html">namd-2.8</a></li>
<li><a class="el" href="namd-2_9.html">namd-2.9</a></li>
<li><a class="el" href="qespresso-5_0_2.html">qespresso-5.0.2</a></li>
</ul>
<p>To patch your MD code, you should have PLUMED already properly working. In particular, you should have the command "plumed" in your execution path, either because it is installed or because you are using it from the compilation directory. Then, follow these steps</p>
<ul>
<li>Configure and compile your MD enginge</li>
<li>Test if it is working properly</li>
<li>Go to the root diretory of the MD engine</li>
<li>Patch: <pre class="fragment">&gt; plumed patch -p
</pre> The script will interactively ask which MD engine you are patching.</li>
<li>Recompile the MD code (if dependencies are set up properly in the MD engine, only modified files will be recompiled)</li>
</ul>
<p>There are different options when patching, check them using </p>
<pre class="fragment">&gt; plumed patch --help
</pre><p> Interesing ones:</p>
<ul>
<li>&ndash;shared allows you to link PLUMED as a shared library. when PLUMED is updated, there will be no need to recompile the MD code</li>
<li>&ndash;runtime allows you to choose the location of the PLUMED library at runtime, setting the variable PLUMED_KERNEL.</li>
<li>&ndash;static (default) just link PLUMED as a collection of object files</li>
</ul>
<p>A note for cross compiling: in case you are compiling an executable from a different machine, then "plumed" executable will not be available in the compilation environment. You can thus use the following command </p>
<pre class="fragment">&gt; plumed-patch
</pre><p> as a replacement of "plumed patch". This trick only works with those commands which are implemented as pure scripts (e.g. there is no "plumed-help" available...).</p>
<p>If your MD code is not supported, you may want to implement an interface for it. Refer to the <a href="../../developer-doc/html/index.html">developer manual </a>. </p>
</div></div>


<hr class="footer"/><address class="footer"><small>
<table align="center" frame="void" width="98%" cellpadding="2%">
<tr><td align="left" valign="center"> 
Hosted by GitHub &nbsp;
<a href="http://github.com"><img src="Octocat.png" width="88" height="66"  alt="GitHub Logo" /></a>
 <a href="http://www.doxygen.org/index.html">
</td><td width=90% align="right">
<img class="footer" src="doxygen.png" alt="doxygen" align="right"/>
</a> 1.8.5
</td> </tr> 
</table>
</small></address>
</body>
</html>
